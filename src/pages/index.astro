---
import Layout from '../layouts/Layout.astro';
import LoadingImage from '../components/LoadingImage';
import { getSiteSettings, getServices, getTestimonials, urlFor, hasValidAsset } from '../lib/sanity';

const [settings, servicesData, testimonialsData] = await Promise.all([
  getSiteSettings(),
  getServices(),
  getTestimonials()
]);

const services = servicesData.slice(0, 3);
const testimonials = testimonialsData.slice(0, 2);
const tagline = settings?.tagline ?? '';
const taglineWords = tagline.split(' ');
const taglineStart = taglineWords.slice(0, 2).join(' ');
const taglineHighlight = taglineWords.slice(2).join(' ');

const heroImageUrl = hasValidAsset(settings?.heroImage)
  ? urlFor(settings.heroImage).width(400).height(400).url() 
  : null;
---

<Layout title="Home">
  <div class="home">
    <section class="hero">
      <div class="hero-background">
        <div class="hero-pattern"></div>
      </div>
      <div class="container hero-content">
        <div class="hero-text">
          <span class="hero-tag">Professional Dog Sitting</span>
          <h1 class="hero-title">
            {taglineStart}{' '}
            <span class="highlight">{taglineHighlight}</span>
          </h1>
          <p class="hero-subtitle">
            Dogs love me, just ask them! Professional, caring dog sitting services 
            with all the belly rubs, walks, and adventures they deserve.
          </p>
          <div class="hero-cta">
            <a href="/contact" class="btn btn-primary">
              Book a Stay
            </a>
            <a href="/services" class="btn btn-outline">
              View Services
            </a>
          </div>
        </div>
        <div class="hero-image">
          <div class="hero-image-wrapper">
            <LoadingImage
              client:load
              src={heroImageUrl}
              alt="Happy dog"
              lqip={settings?.heroImageLqip}
              size={400}
            />
            <div class="floating-badge">
              <span>‚≠ê 5-Star Rated</span>
            </div>
          </div>
        </div>
      </div>
      <div class="hero-wave">
        <svg viewBox="0 0 1440 120" preserveAspectRatio="none">
          <path
            fill="var(--color-background)"
            d="M0,64 C480,150 960,0 1440,64 L1440,120 L0,120 Z"
          />
        </svg>
      </div>
    </section>

    <section class="section services-preview">
      <div class="container">
        <h2 class="section-title">What I Offer</h2>
        <p class="section-subtitle">
          Every dog deserves personalized care. Here's how I can help!
        </p>
        
        <div class="services-grid">
          {services.map((service, index) => (
            <div 
              class="card service-card animate-fade-in-up"
              style={`animation-delay: ${index * 100}ms`}
            >
              <span class="service-icon">{service.icon || 'üêï'}</span>
              <h3 class="service-title">{service.title}</h3>
              <p class="service-description">{service.description}</p>
            </div>
          ))}
        </div>
        
        <div class="see-all">
          <a href="/services" class="btn btn-secondary">
            See All Services
          </a>
        </div>
      </div>
    </section>

    <section class="about-preview">
      <div class="container">
        <div class="about-content">
          <div class="about-image">
            <div class="about-image-wrapper">
              <div class="about-image-placeholder">
                <span>üêæ</span>
              </div>
            </div>
          </div>
          <div class="about-text">
            <h2 class="about-title">Hi, I'm Jess!</h2>
            <p class="about-description">
              I'm pretty great, just ask WizzieBear! With a genuine love for dogs 
              and years of experience, I treat every pup like family. Whether it's 
              long walks, cozy cuddles, or exciting playtime, your furry friend 
              will have the best time with me.
            </p>
            <ul class="about-highlights">
              <li>‚ú® Pet First Aid Certified</li>
              <li>‚ú® 5+ Years Experience</li>
              <li>‚ú® Insured & Background Checked</li>
            </ul>
            <a href="/about" class="btn btn-primary">
              Learn More About Me
            </a>
          </div>
        </div>
      </div>
    </section>

    <section class="section testimonials-preview">
      <div class="container">
        <h2 class="section-title">What Pet Parents Say</h2>
        <p class="section-subtitle">
          Don't just take my word for it - hear from happy clients!
        </p>
        
        <div class="testimonials-grid">
          {testimonials.map((testimonial, index) => (
            <div 
              class="card testimonial-card"
              style={`animation-delay: ${index * 100}ms`}
            >
              <div class="testimonial-quote">
                <span class="quote-icon">"</span>
                <p>{testimonial.quote}</p>
              </div>
              <div class="testimonial-author">
                <div class="testimonial-avatar">
                  {hasValidAsset(testimonial.image) ? (
                    <img src={urlFor(testimonial.image).width(48).height(48).url()} alt={testimonial.dogName} />
                  ) : <span>üêï</span>}
                </div>
                <div>
                  <strong>{testimonial.name}</strong>
                  <span>& {testimonial.dogName}</span>
                </div>
              </div>
            </div>
          ))}
        </div>
        
        <div class="see-all">
          <a href="/testimonials" class="btn btn-outline">
            Read All Testimonials
          </a>
        </div>
      </div>
    </section>

    <section class="cta-section">
      <div class="container">
        <div class="cta-content">
          <h2 class="cta-title">Ready for Your Pup's Best Stay?</h2>
          <p class="cta-subtitle">
            Let's chat about how I can help care for your furry family member!
          </p>
          <a href="/contact" class="btn btn-primary">
            Get in Touch
          </a>
        </div>
      </div>
    </section>
  </div>
</Layout>

<style>
  /* Hero Section */
  .hero {
    position: relative;
    min-height: calc(100vh - var(--header-height));
    display: flex;
    align-items: center;
    overflow: hidden;
  }

  .hero-background {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      135deg,
      var(--color-cream) 0%,
      #f5ebe0 50%,
      var(--color-sand) 100%
    );
    z-index: 0;
  }

  .hero-pattern {
    position: absolute;
    inset: 0;
    background-image: radial-gradient(var(--color-terracotta) 1px, transparent 1px);
    background-size: 30px 30px;
    opacity: 0.05;
  }

  .hero-content {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-3xl);
    align-items: center;
    padding: var(--space-4xl) 0;
  }

  .hero-text {
    animation: fadeInUp 0.8s ease forwards;
  }

  .hero-tag {
    display: inline-block;
    padding: var(--space-sm) var(--space-md);
    background-color: var(--color-forest);
    color: var(--color-white);
    font-size: var(--text-sm);
    font-weight: 600;
    border-radius: var(--radius-full);
    margin-bottom: var(--space-lg);
  }

  .hero-title {
    font-size: var(--text-4xl);
    margin-bottom: var(--space-lg);
    line-height: 1.1;
  }

  .highlight {
    color: var(--color-primary);
    position: relative;
  }

  .highlight::after {
    content: '';
    position: absolute;
    bottom: 0.1em;
    left: 0;
    right: 0;
    height: 0.2em;
    background-color: var(--color-primary);
    opacity: 0.2;
    border-radius: var(--radius-full);
  }

  .hero-subtitle {
    font-size: var(--text-lg);
    color: var(--color-text-muted);
    margin-bottom: var(--space-xl);
    max-width: 500px;
  }

  .hero-cta {
    display: flex;
    gap: var(--space-md);
    flex-wrap: wrap;
  }

  .hero-image {
    display: flex;
    justify-content: center;
  }

  .hero-image-wrapper {
    position: relative;
  }

  .floating-badge {
    position: absolute;
    bottom: 20px;
    right: -20px;
    background-color: var(--color-white);
    padding: var(--space-md) var(--space-lg);
    border-radius: var(--radius-full);
    box-shadow: var(--shadow-lg);
    font-weight: 600;
    animation: float 3s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  .hero-wave {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 1;
  }

  .hero-wave svg {
    display: block;
    width: 100%;
    height: 80px;
  }

  /* Services Preview */
  .services-preview {
    background-color: var(--color-background);
  }

  .services-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-xl);
    margin-bottom: var(--space-2xl);
  }

  .service-card {
    text-align: center;
    padding: var(--space-2xl);
  }

  .service-icon {
    font-size: 3rem;
    margin-bottom: var(--space-md);
    display: block;
  }

  .service-title {
    font-family: var(--font-display);
    font-size: var(--text-xl);
    margin-bottom: var(--space-md);
  }

  .service-description {
    color: var(--color-text-muted);
    font-size: var(--text-sm);
  }

  .see-all {
    text-align: center;
  }

  /* About Preview */
  .about-preview {
    padding: var(--space-4xl) 0;
    background-color: var(--color-forest);
    color: var(--color-white);
  }

  .about-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-3xl);
    align-items: center;
  }

  .about-image-placeholder {
    width: 100%;
    max-width: 400px;
    aspect-ratio: 1;
    border-radius: var(--radius-xl);
    background: linear-gradient(135deg, var(--color-terracotta), var(--color-sand));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 8rem;
    box-shadow: var(--shadow-xl);
    margin: 0 auto;
  }

  .about-title {
    font-size: var(--text-3xl);
    margin-bottom: var(--space-lg);
    color: var(--color-white);
  }

  .about-description {
    font-size: var(--text-lg);
    margin-bottom: var(--space-xl);
    opacity: 0.9;
    line-height: 1.8;
  }

  .about-highlights {
    margin-bottom: var(--space-xl);
  }

  .about-highlights li {
    font-size: var(--text-base);
    padding: var(--space-sm) 0;
    opacity: 0.9;
  }

  /* Testimonials Preview */
  .testimonials-preview {
    background-color: var(--color-background);
  }

  .testimonials-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-xl);
    margin-bottom: var(--space-2xl);
  }

  .testimonial-card {
    padding: var(--space-2xl);
  }

  .testimonial-quote {
    position: relative;
    margin-bottom: var(--space-lg);
  }

  .quote-icon {
    font-family: var(--font-display);
    font-size: 4rem;
    color: var(--color-primary);
    opacity: 0.3;
    line-height: 0;
    position: absolute;
    top: -10px;
    left: -10px;
  }

  .testimonial-quote p {
    font-size: var(--text-lg);
    font-style: italic;
    line-height: 1.7;
    padding-left: var(--space-xl);
  }

  .testimonial-author {
    display: flex;
    align-items: center;
    gap: var(--space-md);
  }

  .testimonial-avatar {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-full);
    background-color: var(--color-sand);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    overflow: hidden;
  }

  .testimonial-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .testimonial-author strong {
    display: block;
    color: var(--color-text);
  }

  .testimonial-author span {
    color: var(--color-text-muted);
    font-size: var(--text-sm);
  }

  /* CTA Section */
  .cta-section {
    padding: var(--space-4xl) 0;
    background: linear-gradient(135deg, var(--color-terracotta), var(--color-terracotta-dark));
    text-align: center;
  }

  .cta-content {
    max-width: 600px;
    margin: 0 auto;
  }

  .cta-title {
    font-size: var(--text-3xl);
    color: var(--color-white);
    margin-bottom: var(--space-md);
  }

  .cta-subtitle {
    font-size: var(--text-lg);
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: var(--space-xl);
  }

  .cta-section .btn-primary {
    background-color: var(--color-white);
    color: var(--color-primary);
  }

  .cta-section .btn-primary:hover {
    background-color: var(--color-cream);
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .hero-content {
      grid-template-columns: 1fr;
      text-align: center;
    }

    .hero-subtitle {
      max-width: none;
      margin-left: auto;
      margin-right: auto;
    }

    .hero-cta {
      justify-content: center;
    }

    .services-grid {
      grid-template-columns: 1fr;
    }

    .about-content {
      grid-template-columns: 1fr;
      text-align: center;
    }

    .about-text {
      order: 1;
    }

    .about-image {
      order: 2;
    }

    .testimonials-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .hero-title {
      font-size: var(--text-3xl);
    }

    .floating-badge {
      right: 0;
      bottom: 0;
    }
  }
</style>
